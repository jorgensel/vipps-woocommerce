
// Betale eksisterende ordre ser *slik* ut:
https://vdev.digitalt.org/vipps_checkout/order-pay/3173/?pay_for_order=true&key=wc_order_a8qIMx4figarw

 $order_id = absint( get_query_var( 'order-pay' ) );


https://vdev.digitalt.org/handlekurv/?cancel_order=true&order=wc_order_a8qIMx4figarw&order_id=3173&redirect=https%3A%2F%2Fvdev.digitalt.org%2Fmin-konto%2F&_wpnonce=1218cd637c

så ha en hook på order-cancelled også plz

** lag en ordremeta som er *vipps session*
** foreløpig:

 WC()->session->get('vipps_checkout_current_pending')
     $order = $current_pending ? wc_get_order($current_pending) : null;

       $current_vipps_session = $order ? WC()->session->get('current_vipps_session') : false;
         // A single word or array containing session data, containing token and frontendFrameUrl
        // ERROR EXPIRED FAILED
        $session_status = $current_vipps_session ? $this->get_vipps_checkout_status($current_vipps_session) : null;

	   if (WC()->session) {
            WC()->session->set('vipps_checkout_current_pending',0);
            WC()->session->set('current_vipps_session', null);
            WC()->session->set('vipps_address_hash', false);


det er altås en current pending ordre, current session, og vipps address hash, samtidig

Alt kan pakkes inn i en verdi som er ordreobjektet. 

Vipps address hash var for å rekalkulere shipping tror, så det kan kanskje fjernes nå,
men åå hente adresseinfo er relevatn igjen for delendum


REMOVE ALL userDetails from checkout

HANDLE LOGIN AND USER CREATION BY USING


    [userInfo] => Array
        (
            [sub] => 0ea76f1a-7102-4947-b53f-9a7aff1ea5e9
            [email] => iver+test@wp-hosting.no
        )

- IF PRESENT - but check against actual order used? order->get_meta('vipps_email', 'vipps, sub')?



In the poll handler: line 1655. Poll checkout, then get userDetails, anonymouse them if neccessary, then set billing and shipping
Finally handle set_order_shipping_details line 1704

In getPaymentDetails, on line around 1816, normalize phoneNumber, userId, phoneNumber

Then again in handle callback anonymousify userDetails on 2379, set shipping details on 2407

så jeg må lage en "ensureUserDetails"

TODO: Skift tittel på siden fra Vipps Checkout til <ikkenoe> elns
TODO: Skift tekst på "feilmelding fra vipps" til "melding i vipps"


	
stringHELTHJEM
Default: "HELTHJEM"
Enum: "POSTEN" "POSTNORD" "PORTERBUDDY" "INSTABOX" "HELTHJEM" "OTHER"

INTEGRATIONS: Kan jeg få til dette i *en global setting*-ting?
** ser ikke sånn ut - jeg kan lage en shipping method uten supports "shippingzones" men denne er altså da legacy og dette kan 
** bli borte. Det er ingen filtre, untatt de som registrerer metoden, så man får da ikke settingsene.
** Only shipping methods that support Shipping Zones are listed. If you have a method that does not support Shipping Zone, it is shown in the navigation menu and works globally/independent of Shipping Zones.
** => så man kan returnere false osv fra is available osv.



integrations	: porterbuddy, instabox, helthjem
object or null
Some optional checkout features require carrier-specific configuration. Can not be used with AddressFields set to false.

porterbuddy	
object or null
Configuration required to enable Porterbuddy logistics options

publicToken	
string
The public key provided to you by Porterbuddy

apiKey	
string
The API key provided to you by Porterbuddy

origin	object Information about the sender

name	string The name of your store

email	string Your email address where Porterbuddy booking confirmation will be sent

phoneNumber	string Your phone number where Porterbuddy may send you important messages. Format must be MSISDN (including country code). Example: "4791234567"

address	object Your address where Porterbuddy will pick up the parcels

streetAddress	string Example: "Robert Levins gate 5"

postalCode	string Example: "0154"

city	string Example: "Oslo"

country	string
The ISO-3166-1 Alpha-2 representation of the country. Example: "NO"

instabox	object or null
Configuration required to enable Instabox logistics options

clientId	string
The client id provided to you by Instabox

clientSecret	string
The client secret provided to you by Instabox

helthjem	object or null
Configuration required to enable Helthjem logistics options

username	string
The Username provided to you by Helthjem
password	string
The Password provided to you by Helthjem

shopId	integer <int32>
The ShopId provided to you by Helthjem
